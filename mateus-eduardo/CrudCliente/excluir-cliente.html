<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[RFS04] Excluir Cliente</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 2em; }
        form { max-width: 800px; margin: auto; padding: 1em; border: 1px solid #ccc; border-radius: 1em; }
        fieldset { border: none; padding: 0; margin-bottom: 2em; }
        legend h1, legend h2 { margin: 0 0 .5em 0; font-size: 1.2em; }
        label { display: block; margin-top: 1em; font-weight: 600; }
        input, select { width: 100%; padding: .5em; margin-top: .5em; box-sizing: border-box; }
        button { margin-top: 1.5em; padding: .7em 1.2em; cursor: pointer; }
        .row { display: flex; gap: 1em; flex-wrap: wrap; }
        .col { flex: 1 1 240px; }
        .resumo-box { background:#f5f5f5; border:1px solid #ccc; border-radius:.5em; padding:1em; font-size:.9em; color:#333; }
        .alerta { color:#c00; font-size:.9em; font-weight:bold; margin-top:1em; display:none; }
        .confirm-group { display:flex; align-items:flex-start; gap:.5em; margin-top:1em; font-size:.9em; }
        .confirm-group input { width:auto; margin-top:.3em; }
        small { color:#555; font-size:.8em; font-weight:normal; }
    </style>
</head>
<body>

<!-- localizar cliente -->
<form action="#" method="get" id="formBuscarExcluirCliente">
    <fieldset>
        <legend><h1>[RFS04] Excluir Cliente</h1></legend>
        <p>
            A exclusão exige confirmação. Existem dois modos:
            <strong>Desativar</strong> (status → Inativo, histórico mantido)
            ou <strong>Excluir definitivamente</strong> (remover da base).
            Se o cliente tiver vínculos (vendas, pedidos, fidelidade, etc.),
            bloquear exclusão definitiva e orientar a inativação.
        </p>

        <div class="row">
            <div class="col">
                <label for="cod_excluir">Código Interno</label>
                <input type="text" id="cod_excluir" name="cod_excluir" placeholder="Ex: 123">
            </div>

            <div class="col">
                <label for="cpf_excluir">CPF</label>
                <input type="text" id="cpf_excluir" name="cpf_excluir" maxlength="14" placeholder="000.000.000-00">
            </div>
        </div>

        <button type="submit">Carregar Cliente</button>
    </fieldset>
</form>

<!-- resumo + ação -->
<form action="#" method="post" id="formExcluirCliente">
    <fieldset>
        <legend><h2>Dados do Cliente Selecionado</h2></legend>

        <div class="resumo-box" id="resumo_cliente">
            <strong>Cliente:</strong> Ana Silva (Cód 123)<br>
            <strong>CPF:</strong> 123.456.789-10<br>
            <strong>Status atual:</strong> Ativo<br>
            <strong>Telefone:</strong> (11) 222-333<br>
            <strong>Endereço:</strong> Bairro Central, Rua das Flores, 120 — CEP 12345-678<br>
            <strong>Data de cadastro:</strong> 02/11/2025<br>
            <strong>Possui vínculos?</strong> Sim (vendas e pedidos)
        </div>

        <p style="margin-top:1em;">
            <strong>Modo de exclusão:</strong><br>
            <label>
                <input type="radio" name="acao_exclusao" value="inativar" checked>
                Desativar cliente (muda status para Inativo, mantém histórico)
            </label><br>
            <label>
                <input type="radio" name="acao_exclusao" value="definitiva" id="opcao_definitiva" disabled>
                Excluir definitivamente do sistema
            </label><br>
            <small>
                Exclusão definitiva só é permitida quando <u>não houver vínculos</u>.
                Se houver vínculos, deve-se apenas inativar.
            </small>
        </p>

        <div id="alerta_vinculo" class="alerta">
            Exclusão definitiva bloqueada: este cliente possui vínculos (ex.: vendas/pedidos).
        </div>

        <div class="confirm-group">
            <input type="checkbox" id="confirmar_acao">
            <label for="confirmar_acao">
                Confirmo que desejo executar essa ação e entendo que será registrada em auditoria (tipo da ação, data/hora, usuário).
            </label>
        </div>

        <button type="submit">Executar</button>
        <button type="reset">Cancelar</button>
    </fieldset>
</form>

<script>
    // máscara CPF
    const cpfExcluir = document.getElementById("cpf_excluir");
    cpfExcluir.addEventListener("input", function() {
        let v = cpfExcluir.value.replace(/\D/g, "").slice(0,11);
        if (v.length > 9) v = v.replace(/(\d{3})(\d{3})(\d{3})(\d{0,2})/, "$1.$2.$3-$4");
        else if (v.length > 6) v = v.replace(/(\d{3})(\d{3})(\d{0,3})/, "$1.$2.$3");
        else if (v.length > 3) v = v.replace(/(\d{3})(\d{0,3})/, "$1.$2");
        cpfExcluir.value = v;
    });

    // submissão da exclusão
    document.getElementById("formExcluirCliente").addEventListener("submit", function(e){
        const radioDef = document.getElementById("opcao_definitiva");
        const confirmou = document.getElementById("confirmar_acao").checked;
        const alerta = document.getElementById("alerta_vinculo");

        // se a opção definitiva estiver desabilitada, mas marcada, bloquear
        // (navegador normalmente nem deixa marcar disabled, mas vamos garantir)
        if (radioDef.disabled && radioDef.checked) {
            alerta.style.display = "block";
            alert("Exclusão definitiva bloqueada. Cliente possui vínculos. Use 'Desativar'.");
            e.preventDefault();
            return;
        }

        if (!confirmou) {
            alert("Você precisa confirmar antes de executar a ação.");
            e.preventDefault();
            return;
        }

        const certeza = confirm("Tem certeza? Esta ação será registrada em auditoria.");
        if (!certeza) {
            e.preventDefault();
        }
    });
</script>

</body>
</html>
