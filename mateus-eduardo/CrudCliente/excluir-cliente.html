<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[RFS04] Excluir Cliente</title>
    <style>
        :root {
                --primary-color: #dc3545; /* Vermelho para alerta/exclusão */
                --secondary-color: #6c757d;
                --light-bg: #f8f9fa;
                --white: #ffffff;
            }
            body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 20px; background-color: var(--light-bg); }
            .card { max-width: 900px; margin: auto; padding: 25px; background: var(--white); border-radius: 8px; box-shadow: 0 0 15px rgba(0, 0, 0, 0.05); }
            legend h1 { 
                margin: 0 0 15px 0; 
                font-size: 1.8em; 
                color: var(--primary-color); 
                border-bottom: 2px solid #e9ecef; 
                padding-bottom: 10px; 
            }

            /* Formulário de Busca Inicial */
            .search-form {
                display: flex;
                gap: 10px;
                align-items: flex-end;
                padding-bottom: 20px;
                border-bottom: 1px dashed #ced4da;
                margin-bottom: 20px;
            }
            .search-form .col { flex: 1; }
            label { 
                display: block; 
                margin-top: 15px; 
                font-weight: 600; 
                font-size: 0.95em; 
                color: #343a40; 
            }
            input { 
                width: 100%; 
                padding: 10px; 
                margin-top: 5px; 
                box-sizing: border-box; 
                border: 1px solid #ced4da;
                border-radius: 4px;
            }
            .search-button {
                background-color: var(--primary-color);
                color: var(--white);
                padding: 10px 15px;
                border: none;
                border-radius: 4px;
                cursor: pointer;
                transition: background-color 0.2s;
            }
            .search-button:hover { background-color: #c82333; }
            
            /* Área de Detalhes do Cliente */
            .client-details {
                background-color: #fcebeb; /* Fundo levemente vermelho para destaque */
                border: 1px solid var(--primary-color);
                padding: 20px;
                border-radius: 6px;
                margin-top: 20px;
            }
            .detail-item {
                margin-bottom: 10px;
                font-size: 1.05em;
            }
            .detail-item strong {
                color: #343a40;
                display: inline-block;
                min-width: 100px;
            }
            
            /* Botões de Ação */
            .actions { margin-top: 25px; text-align: right; }
            button { 
                padding: 12px 20px; 
                cursor: pointer;
                border: none;
                border-radius: 5px;
                font-weight: 600;
                transition: background-color 0.2s;
            }
            /* Botão Principal de Exclusão/Inativação (Vermelho) */
            button[type="submit"] { background-color: var(--primary-color); color: var(--white); }
            button[type="submit"]:hover { background-color: #c82333; }
            /* Botão de Cancelar */
            button[type="reset"] { background-color: var(--secondary-color); color: var(--white); margin-left: 10px; }
            button[type="reset"]:hover { background-color: #5a6268; }
    </style>
</head>
<body>

<!-- localizar cliente -->
<form action="#" method="get" id="formBuscarExcluirCliente">
    <fieldset>
        <legend><h1>[RFS04] Excluir Cliente</h1></legend>
        <p>
            A exclusão exige confirmação. Existem dois modos:
            <strong>Desativar</strong> (status → Inativo, histórico mantido)
            ou <strong>Excluir definitivamente</strong> (remover da base).
            Se o cliente tiver vínculos (vendas, pedidos, fidelidade, etc.),
            bloquear exclusão definitiva e orientar a inativação.
        </p>

        <div class="row">
            <div class="col">
                <label for="cod_excluir">Código Interno</label>
                <input type="text" id="cod_excluir" name="cod_excluir" placeholder="Ex: 123">
            </div>

            <div class="col">
                <label for="cpf_excluir">CPF</label>
                <input type="text" id="cpf_excluir" name="cpf_excluir" maxlength="14" placeholder="000.000.000-00">
            </div>
        </div>

        <button type="submit">Carregar Cliente</button>
    </fieldset>
</form>

<!-- resumo + ação -->
<form action="#" method="post" id="formExcluirCliente">
    <fieldset>
        <legend><h2>Dados do Cliente Selecionado</h2></legend>

        <div class="resumo-box" id="resumo_cliente">
            <strong>Cliente:</strong> Ana Silva (Cód 123)<br>
            <strong>CPF:</strong> 123.456.789-10<br>
            <strong>Status atual:</strong> Ativo<br>
            <strong>Telefone:</strong> (11) 222-333<br>
            <strong>Endereço:</strong> Bairro Central, Rua das Flores, 120 — CEP 12345-678<br>
            <strong>Data de cadastro:</strong> 02/11/2025<br>
            <strong>Possui vínculos?</strong> Sim (vendas e pedidos)
        </div>

        <p style="margin-top:1em;">
            <strong>Modo de exclusão:</strong><br>
            <label>
                <input type="radio" name="acao_exclusao" value="inativar" checked>
                Desativar cliente (muda status para Inativo, mantém histórico)
            </label><br>
            <label>
                <input type="radio" name="acao_exclusao" value="definitiva" id="opcao_definitiva" disabled>
                Excluir definitivamente do sistema
            </label><br>
            <small>
                Exclusão definitiva só é permitida quando <u>não houver vínculos</u>.
                Se houver vínculos, deve-se apenas inativar.
            </small>
        </p>

        <div id="alerta_vinculo" class="alerta">
            Exclusão definitiva bloqueada: este cliente possui vínculos (ex.: vendas/pedidos).
        </div>

        <div class="confirm-group">
            <input type="checkbox" id="confirmar_acao">
            <label for="confirmar_acao">
                Confirmo que desejo executar essa ação e entendo que será registrada em auditoria (tipo da ação, data/hora, usuário).
            </label>
        </div>

        <button type="submit">Executar</button>
        <button type="reset">Cancelar</button>
    </fieldset>
</form>

<script>
    // máscara CPF
    const cpfExcluir = document.getElementById("cpf_excluir");
    cpfExcluir.addEventListener("input", function() {
        let v = cpfExcluir.value.replace(/\D/g, "").slice(0,11);
        if (v.length > 9) v = v.replace(/(\d{3})(\d{3})(\d{3})(\d{0,2})/, "$1.$2.$3-$4");
        else if (v.length > 6) v = v.replace(/(\d{3})(\d{3})(\d{0,3})/, "$1.$2.$3");
        else if (v.length > 3) v = v.replace(/(\d{3})(\d{0,3})/, "$1.$2");
        cpfExcluir.value = v;
    });

    // submissão da exclusão
    document.getElementById("formExcluirCliente").addEventListener("submit", function(e){
        const radioDef = document.getElementById("opcao_definitiva");
        const confirmou = document.getElementById("confirmar_acao").checked;
        const alerta = document.getElementById("alerta_vinculo");

        // se a opção definitiva estiver desabilitada, mas marcada, bloquear
        // (navegador normalmente nem deixa marcar disabled, mas vamos garantir)
        if (radioDef.disabled && radioDef.checked) {
            alerta.style.display = "block";
            alert("Exclusão definitiva bloqueada. Cliente possui vínculos. Use 'Desativar'.");
            e.preventDefault();
            return;
        }

        if (!confirmou) {
            alert("Você precisa confirmar antes de executar a ação.");
            e.preventDefault();
            return;
        }

        const certeza = confirm("Tem certeza? Esta ação será registrada em auditoria.");
        if (!certeza) {
            e.preventDefault();
        }
    });
</script>

</body>
</html>
