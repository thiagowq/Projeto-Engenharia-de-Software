<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[RFS03] Editar Cliente</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 2em; }
        form { max-width: 900px; margin: auto; padding: 1em; border: 1px solid #ccc; border-radius: 1em; }
        fieldset { border: none; padding: 0; margin-bottom: 2em; }
        legend h1, legend h2 { margin: 0 0 .5em 0; font-size: 1.2em; }
        label { display: block; margin-top: 1em; font-weight: 600; }
        input, select { width: 100%; padding: .5em; margin-top: .5em; box-sizing: border-box; }
        small { color: #555; font-size: .8em; font-weight: normal; }
        .row { display: flex; gap: 1em; flex-wrap: wrap; }
        .col { flex: 1 1 240px; }
        button { margin-top: 1.5em; padding: .7em 1.2em; cursor: pointer; }
        .inline-check { display:flex; align-items:center; gap:.5em; font-size:.9em; margin-top:2em; }
        .inline-check input { width:auto; margin-top:0; }
        .audit-box { background:#f5f5f5; border:1px solid #ccc; border-radius:.5em; padding:1em; font-size:.9em; color:#333; }
        .danger { color:#c00; font-weight:bold; font-size:.85em; }
    </style>
</head>
<body>

<!-- Buscar cliente -->
<form action="#" method="get" id="formBuscarCliente">
    <fieldset>
        <legend><h1>[RFS03] Editar Cliente</h1></legend>
        <p>Localizar cliente já cadastrado para edição. Campos que podem ser alterados: Nome, Data de Nascimento, E-mail, Telefones, Endereço completo e Status.</p>

        <div class="row">
            <div class="col">
                <label for="busca_codigo">Código Interno</label>
                <input type="text" id="busca_codigo" name="busca_codigo" placeholder="Ex: 123">
            </div>

            <div class="col">
                <label for="busca_cpf">CPF</label>
                <input type="text" id="busca_cpf" name="busca_cpf" maxlength="14" placeholder="000.000.000-00">
            </div>
        </div>

        <button type="submit">Carregar Dados</button>
    </fieldset>
</form>

<!-- Form de edição -->
<form action="#" method="post" id="formEditarCliente">
    <fieldset>
        <legend><h2>Dados do Cliente</h2></legend>

        <div class="row">
            <div class="col">
                <label for="codigo_interno_edit">Código Interno</label>
                <input type="text" id="codigo_interno_edit" name="codigo_interno_edit" value="123" readonly>
            </div>

            <div class="col">
                <label for="cpf_edit">CPF</label>
                <input type="text" id="cpf_edit" name="cpf_edit" value="123.456.789-10" maxlength="14" readonly>
                <small>CPF não pode mudar para um valor já existente. Se sua regra permitir editar CPF, precisa manter 11 dígitos válidos.</small>
            </div>

            <div class="col inline-check">
                <input type="checkbox" id="permitir_cpf">
                <label for="permitir_cpf">Permitir alterar CPF</label>
                <span class="danger">(cuidado: CPF deve continuar único)</span>
            </div>
        </div>

        <div class="row">
            <div class="col">
                <label for="nome_edit">Nome completo</label>
                <input type="text" id="nome_edit" name="nome_edit" maxlength="100" value="Ana Silva">
            </div>

            <div class="col">
                <label for="data_nasc_edit">Data de nascimento</label>
                <input type="date" id="data_nasc_edit" name="data_nasc_edit" value="2000-05-20">
            </div>

            <div class="col">
                <label for="email_edit">E-mail</label>
                <input type="email" id="email_edit" name="email_edit" placeholder="ana@gmail.com">
                <small>Se informar e-mail, não pode repetir em outro cliente ativo.</small>
            </div>
        </div>

        <div class="row">
            <div class="col">
                <label for="tel1_edit">Telefone principal</label>
                <input type="text" id="tel1_edit" name="tel1_edit" maxlength="20" value="(11) 222-333">
            </div>

            <div class="col">
                <label for="tel2_edit">Telefone alternativo</label>
                <input type="text" id="tel2_edit" name="tel2_edit" maxlength="20" placeholder="(11) 999-000">
            </div>

            <div class="col">
                <label for="status_edit">Status</label>
                <select id="status_edit" name="status_edit">
                    <option>Ativo</option>
                    <option>Inativo</option>
                </select>
            </div>
        </div>

        <div class="row">
            <div class="col">
                <label for="bairro_edit">Bairro</label>
                <input type="text" id="bairro_edit" name="bairro_edit" value="Bairro Central">
            </div>

            <div class="col">
                <label for="rua_edit">Rua</label>
                <input type="text" id="rua_edit" name="rua_edit" value="Rua das Flores">
            </div>

            <div class="col">
                <label for="numero_edit">Número</label>
                <input type="text" id="numero_edit" name="numero_edit" value="120">
            </div>
        </div>

        <div class="row">
            <div class="col">
                <label for="cep_edit">CEP</label>
                <input type="text" id="cep_edit" name="cep_edit" maxlength="9" value="12345-678">
            </div>
        </div>

        <div style="margin-top:1.5em;">
            <div class="audit-box">
                <strong>Auditoria</strong><br>
                Última alteração: 02/11/2025 14:32<br>
                Usuário responsável: usuario.gerente<br><br>

                O sistema deve registrar:
                <ul>
                    <li>Data/hora da alteração</li>
                    <li>Usuário que alterou</li>
                    <li>Valores antes e depois (por ex.: Status Ativo → Inativo)</li>
                </ul>
            </div>
            <small>Essas infos são obrigatórias na política do requisito.</small>
        </div>

        <button type="submit">Salvar Alterações</button>
        <button type="reset">Descartar Mudanças</button>
    </fieldset>
</form>

<script>
    // permitir edição do CPF se marcar o checkbox
    const permitirCPF = document.getElementById("permitir_cpf");
    const cpfEdit = document.getElementById("cpf_edit");

    permitirCPF.addEventListener("change", function() {
        if (permitirCPF.checked) {
            cpfEdit.removeAttribute("readonly");
        } else {
            cpfEdit.setAttribute("readonly", "readonly");
        }
    });

    // máscara CPF no campo editável
    cpfEdit.addEventListener("input", function() {
        let v = cpfEdit.value.replace(/\D/g, "").slice(0,11);
        if (v.length > 9) v = v.replace(/(\d{3})(\d{3})(\d{3})(\d{0,2})/, "$1.$2.$3-$4");
        else if (v.length > 6) v = v.replace(/(\d{3})(\d{3})(\d{0,3})/, "$1.$2.$3");
        else if (v.length > 3) v = v.replace(/(\d{3})(\d{0,3})/, "$1.$2");
        cpfEdit.value = v;
    });

    // máscara simples telefone
    function maskPhone(el) {
        let v = el.value.replace(/\D/g,"").slice(0,9);
        if (v.length > 2) v = "(" + v.slice(0,2) + ") " + v.slice(2);
        if (v.length > 7) {
            const ddd = v.slice(1,3);
            const rest = v.replace(/^\(\d{2}\)\s?/, '');
            if (rest.length > 3) {
                el.value = "(" + ddd + ") " + rest.slice(0,3) + "-" + rest.slice(3,6);
            } else {
                el.value = "(" + ddd + ") " + rest;
            }
        } else {
            el.value = v;
        }
    }

    document.getElementById("tel1_edit").addEventListener("input", function(){ maskPhone(this); });
    document.getElementById("tel2_edit").addEventListener("input", function(){ maskPhone(this); });

    // máscara CEP
    const cepEdit = document.getElementById("cep_edit");
    cepEdit.addEventListener("input", function() {
        let v = cepEdit.value.replace(/\D/g,"").slice(0,8);
        if (v.length > 5) v = v.replace(/(\d{5})(\d{0,3})/,"$1-$2");
        cepEdit.value = v;
    });

    // no submit você validaria duplicidade de e-mail e CPF no backend
    document.getElementById("formEditarCliente").addEventListener("submit", function(e){
        // se CPF estiver destravado, validar 11 dígitos
        if (!cpfEdit.hasAttribute("readonly")) {
            const raw = cpfEdit.value.replace(/\D/g,"");
            if (raw.length !== 11) {
                alert("CPF inválido. Deve conter 11 dígitos.");
                e.preventDefault();
            }
        }
    });
</script>

</body>
</html>
