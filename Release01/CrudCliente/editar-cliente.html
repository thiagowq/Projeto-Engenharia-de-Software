<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editar Cliente</title>
    <style>
            :root {
            --primary-color: #007bff; /* Azul padrão para edição/detalhes */
            --danger-color: #dc3545;
            --light-bg: #f8f9fa;
            --white: #ffffff;
        }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 20px; background-color: var(--light-bg); }
        .card { max-width: 900px; margin: auto; padding: 25px; background: var(--white); border-radius: 8px; box-shadow: 0 0 15px rgba(0, 0, 0, 0.05); }
        legend h1 { 
            margin: 0 0 15px 0; 
            font-size: 1.8em; 
            color: var(--primary-color); 
            border-bottom: 2px solid #e9ecef; 
            padding-bottom: 10px; 
        }
        
        /* Formulário de Busca Inicial */
        .search-form {
            display: flex;
            gap: 10px;
            align-items: flex-end;
            padding-bottom: 20px;
            border-bottom: 1px dashed #ced4da;
            margin-bottom: 20px;
        }
        .search-form .col { flex: 1; }
        label { 
            display: block; 
            margin-top: 15px; 
            font-weight: 600; 
            font-size: 0.95em; 
            color: #343a40; 
        }
        input, select { 
            width: 100%; 
            padding: 10px; 
            margin-top: 5px; 
            box-sizing: border-box; 
            border: 1px solid #ced4da;
            border-radius: 4px;
        }
        .search-button {
            background-color: var(--primary-color);
            color: var(--white);
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .search-button:hover { background-color: #0056b3; }

        /* Formulário de Edição (Aparência Geral) */
        form { padding: 0; }
        .row { display: flex; gap: 20px; flex-wrap: wrap; }
        .col { flex: 1 1 200px; }
        
        label[for*="*"]::after { 
            content: '*';
            color: var(--danger-color);
            margin-left: 3px;
        }
        small { color: #6c757d; font-size: 0.75em; display: block; margin-top: 4px; }
        
        /* Botões de Ação */
        .actions { margin-top: 25px; text-align: right; }
        button { 
            padding: 12px 20px; 
            cursor: pointer;
            border: none;
            border-radius: 5px;
            font-weight: 600;
            transition: background-color 0.2s;
        }
        button[type="submit"] { background-color: var(--primary-color); color: var(--white); }
        button[type="submit"]:hover { background-color: #0056b3; }
        button[type="reset"] { background-color: #6c757d; color: var(--white); margin-left: 10px; }
        button[type="reset"]:hover { background-color: #5a6268; }
    </style>
</head>
<body>

<!-- Buscar cliente -->
<form action="#" method="get" id="formBuscarCliente">
    <fieldset>
        <legend><h1>[RFS03] Editar Cliente</h1></legend>
        <p>Localizar cliente já cadastrado para edição. Campos que podem ser alterados: Nome, Data de Nascimento, E-mail, Telefones, Endereço completo e Status.</p>

        <div class="row">
            <div class="col">
                <label for="busca_codigo">Código Interno</label>
                <input type="text" id="busca_codigo" name="busca_codigo" placeholder="Ex: 123">
            </div>

            <div class="col">
                <label for="busca_cpf">CPF</label>
                <input type="text" id="busca_cpf" name="busca_cpf" maxlength="14" placeholder="000.000.000-00">
            </div>
        </div>

        <button type="submit">Carregar Dados</button>
    </fieldset>
</form>

<!-- Form de edição -->
<form action="#" method="post" id="formEditarCliente">
    <fieldset>
        <legend><h2>Dados do Cliente</h2></legend>

        <div class="row">
            <div class="col">
                <label for="codigo_interno_edit">Código Interno</label>
                <input type="text" id="codigo_interno_edit" name="codigo_interno_edit" value="123" readonly>
            </div>

            <div class="col">
                <label for="cpf_edit">CPF</label>
                <input type="text" id="cpf_edit" name="cpf_edit" value="123.456.789-10" maxlength="14" readonly>
                <small>CPF não pode mudar para um valor já existente. Se sua regra permitir editar CPF, precisa manter 11 dígitos válidos.</small>
            </div>

            <div class="col inline-check">
                <input type="checkbox" id="permitir_cpf">
                <label for="permitir_cpf">Permitir alterar CPF</label>
                <span class="danger">(cuidado: CPF deve continuar único)</span>
            </div>
        </div>

        <div class="row">
            <div class="col">
                <label for="nome_edit">Nome completo</label>
                <input type="text" id="nome_edit" name="nome_edit" maxlength="100" value="Ana Silva">
            </div>

            <div class="col">
                <label for="data_nasc_edit">Data de nascimento</label>
                <input type="date" id="data_nasc_edit" name="data_nasc_edit" value="2000-05-20">
            </div>

            <div class="col">
                <label for="email_edit">E-mail</label>
                <input type="email" id="email_edit" name="email_edit" placeholder="ana@gmail.com">
                <small>Se informar e-mail, não pode repetir em outro cliente ativo.</small>
            </div>
        </div>

        <div class="row">
            <div class="col">
                <label for="tel1_edit">Telefone principal</label>
                <input type="text" id="tel1_edit" name="tel1_edit" maxlength="20" value="(11) 222-333">
            </div>

            <div class="col">
                <label for="tel2_edit">Telefone alternativo</label>
                <input type="text" id="tel2_edit" name="tel2_edit" maxlength="20" placeholder="(11) 999-000">
            </div>

            <div class="col">
                <label for="status_edit">Status</label>
                <select id="status_edit" name="status_edit">
                    <option>Ativo</option>
                    <option>Inativo</option>
                </select>
            </div>
        </div>

        <div class="row">
            <div class="col">
                <label for="bairro_edit">Bairro</label>
                <input type="text" id="bairro_edit" name="bairro_edit" value="Bairro Central">
            </div>

            <div class="col">
                <label for="rua_edit">Rua</label>
                <input type="text" id="rua_edit" name="rua_edit" value="Rua das Flores">
            </div>

            <div class="col">
                <label for="numero_edit">Número</label>
                <input type="text" id="numero_edit" name="numero_edit" value="120">
            </div>
        </div>

        <div class="row">
            <div class="col">
                <label for="cep_edit">CEP</label>
                <input type="text" id="cep_edit" name="cep_edit" maxlength="9" value="12345-678">
            </div>
        </div>

        <div style="margin-top:1.5em;">
            <div class="audit-box">
                <strong>Auditoria</strong><br>
                Última alteração: 02/11/2025 14:32<br>
                Usuário responsável: usuario.gerente<br><br>

                O sistema deve registrar:
                <ul>
                    <li>Data/hora da alteração</li>
                    <li>Usuário que alterou</li>
                    <li>Valores antes e depois (por ex.: Status Ativo → Inativo)</li>
                </ul>
            </div>
            <small>Essas infos são obrigatórias na política do requisito.</small>
        </div>

        <button type="submit">Salvar Alterações</button>
        <button type="reset">Descartar Mudanças</button>
    </fieldset>
</form>

<script>
    // permitir edição do CPF se marcar o checkbox
    const permitirCPF = document.getElementById("permitir_cpf");
    const cpfEdit = document.getElementById("cpf_edit");

    permitirCPF.addEventListener("change", function() {
        if (permitirCPF.checked) {
            cpfEdit.removeAttribute("readonly");
        } else {
            cpfEdit.setAttribute("readonly", "readonly");
        }
    });

    // máscara CPF no campo editável
    cpfEdit.addEventListener("input", function() {
        let v = cpfEdit.value.replace(/\D/g, "").slice(0,11);
        if (v.length > 9) v = v.replace(/(\d{3})(\d{3})(\d{3})(\d{0,2})/, "$1.$2.$3-$4");
        else if (v.length > 6) v = v.replace(/(\d{3})(\d{3})(\d{0,3})/, "$1.$2.$3");
        else if (v.length > 3) v = v.replace(/(\d{3})(\d{0,3})/, "$1.$2");
        cpfEdit.value = v;
    });

    // máscara simples telefone
    function maskPhone(el) {
        let v = el.value.replace(/\D/g,"").slice(0,9);
        if (v.length > 2) v = "(" + v.slice(0,2) + ") " + v.slice(2);
        if (v.length > 7) {
            const ddd = v.slice(1,3);
            const rest = v.replace(/^\(\d{2}\)\s?/, '');
            if (rest.length > 3) {
                el.value = "(" + ddd + ") " + rest.slice(0,3) + "-" + rest.slice(3,6);
            } else {
                el.value = "(" + ddd + ") " + rest;
            }
        } else {
            el.value = v;
        }
    }

    document.getElementById("tel1_edit").addEventListener("input", function(){ maskPhone(this); });
    document.getElementById("tel2_edit").addEventListener("input", function(){ maskPhone(this); });

    // máscara CEP
    const cepEdit = document.getElementById("cep_edit");
    cepEdit.addEventListener("input", function() {
        let v = cepEdit.value.replace(/\D/g,"").slice(0,8);
        if (v.length > 5) v = v.replace(/(\d{5})(\d{0,3})/,"$1-$2");
        cepEdit.value = v;
    });

    // no submit você validaria duplicidade de e-mail e CPF no backend
    document.getElementById("formEditarCliente").addEventListener("submit", function(e){
        // se CPF estiver destravado, validar 11 dígitos
        if (!cpfEdit.hasAttribute("readonly")) {
            const raw = cpfEdit.value.replace(/\D/g,"");
            if (raw.length !== 11) {
                alert("CPF inválido. Deve conter 11 dígitos.");
                e.preventDefault();
            }
        }
    });
</script>

</body>
</html>
